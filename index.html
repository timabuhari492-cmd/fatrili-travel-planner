<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fatirli Smart Travel Kit Planner</title>

  <style>
    :root{
      --bg:#06131a;
      --card: rgba(8, 22, 32, .78);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.66);
      --muted2: rgba(255,255,255,.5);
      --teal:#29f3d1;
      --teal2:#18bca8;
      --gold:#ffd24a;
      --shadow: 0 24px 80px rgba(0,0,0,.5);
      --radius: 18px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background: var(--bg);
      overflow-x:hidden;
    }

    /* BACKGROUND */
    .bg{ position:fixed; inset:0; z-index:-3; background:#021017; }
    .bg::before{
      content:"";
      position:absolute; inset:-40px;
      background-image:url("travel-bg.webp");
      background-size:cover;
      background-position:55% 45%;
      filter:saturate(1.18) contrast(1.05) brightness(.98);
      opacity:.95;
      transform: translate3d(0,0,0);
      will-change: background-position, transform;
      animation: drift 18s ease-in-out infinite alternate;
    }
    .bg::after{
      content:""; position:absolute; inset:0;
      background:
        radial-gradient(1200px 700px at 50% 25%, rgba(0,0,0,.08), rgba(0,0,0,.55) 60%, rgba(0,0,0,.7)),
        linear-gradient(180deg, rgba(0,0,0,.38), rgba(0,0,0,.62));
      z-index:1;
    }
    @keyframes drift{
      0% { background-position:52% 44%; transform:scale(1.02); }
      50%{ background-position:56% 48%; transform:scale(1.03); }
      100%{ background-position:50% 46%; transform:scale(1.02); }
    }
    @media (prefers-reduced-motion: reduce){ .bg::before{ animation:none; } }

    /* HEADER */
    .header{
      width:min(1120px, 100%);
      margin: 0 auto;
      padding: 28px 16px 10px;
    }
    .kicker{
      display:flex; align-items:center; gap:10px;
      font-size:13px; letter-spacing:.18em; text-transform:uppercase;
      color: rgba(255,255,255,.75);
    }
    .dot{ width:9px;height:9px;border-radius:99px;background:var(--teal); box-shadow:0 0 16px rgba(41,243,209,.55); }
    h1{
      margin: 10px 0 6px;
      font-size: clamp(22px, 2.4vw, 34px);
      line-height:1.15;
      text-shadow: 0 10px 30px rgba(0,0,0,.55);
    }
    .sub{
      margin:0;
      color: rgba(255,255,255,.72);
      max-width: 90ch;
      font-size: 14.5px;
      line-height:1.55;
    }

    /* LAYOUT */
    .wrap{
      min-height:100vh;
      padding: 14px 16px 54px;
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }
    .container{
      width:min(1120px, 100%);
      display:flex;
      gap: 18px;
      align-items:flex-start;
    }
    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .left{ flex: 0 0 420px; padding: 16px; }
    .right{ flex: 1; padding: 16px; min-height: 520px; }

    .sectionTitle{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin: 6px 0 10px;
    }
    .sectionTitle h2{ margin:0; font-size: 15.5px; letter-spacing:.02em; }
    .small{ color: var(--muted); font-size: 12.5px; line-height:1.4; }

    label{ display:block; margin: 10px 0 6px; color: rgba(255,255,255,.78); font-size: 12.5px; }
    input[type="text"], input[type="date"], select{
      width:100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.26);
      color: var(--text);
      outline:none;
    }
    input[type="text"]::placeholder{ color: rgba(255,255,255,.38); }
    select option{ background:#06131a; color:#fff; }

    .row{ display:flex; gap: 10px; }
    .row > div{ flex:1; }

    /* CHIP BUTTONS */
    .chips{ display:flex; flex-wrap:wrap; gap: 8px; margin-top: 6px; }
    .chip{
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.84);
      font-size: 12px;
      cursor:pointer;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition: .15s ease;
      font-weight: 900;
    }
    .chip:hover{ border-color: rgba(41,243,209,.35); }
    .chip.on{
      border-color: rgba(41,243,209,.55);
      box-shadow: 0 0 0 2px rgba(41,243,209,.14);
      background: rgba(41,243,209,.10);
      color: rgba(255,255,255,.95);
    }
    .chip .miniDot{ width:8px;height:8px;border-radius:99px; background: rgba(255,255,255,.25); }
    .chip.on .miniDot{ background: var(--teal); box-shadow: 0 0 12px rgba(41,243,209,.6); }

    .btn{
      width:100%;
      margin-top: 10px;
      border: 1px solid rgba(41,243,209,.45);
      color:#06131a;
      background: linear-gradient(90deg, rgba(41,243,209,1), rgba(24,188,168,1));
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 950;
      letter-spacing:.01em;
      box-shadow: 0 12px 34px rgba(0,0,0,.28);
    }
    .btn:active{ transform: translateY(1px); }

    /* Optional modules */
    details{
      margin-top: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      border-radius: 14px;
      overflow:hidden;
    }
    summary{
      list-style:none;
      cursor:pointer;
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      color: rgba(255,255,255,.92);
      font-size: 13px;
      font-weight: 950;
    }
    summary::-webkit-details-marker{ display:none; }
    .badgeHint{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(41,243,209,.35);
      background: rgba(41,243,209,.08);
      color: rgba(255,255,255,.86);
      font-size: 12px;
      white-space:nowrap;
    }
    .detailsBody{ padding: 0 12px 12px; color: var(--muted); font-size: 12.5px; line-height:1.5; }
    .checkrow{ display:flex; align-items:flex-start; gap: 10px; margin: 10px 0; }
    .checkrow input{ margin-top:2px; }
    .checkrow b{ color: rgba(255,255,255,.92); }

    /* Output header + tabs */
    .kitHeader{
      display:flex; align-items:flex-end; justify-content:space-between; gap: 12px;
      margin-bottom: 8px;
    }
    .kitHeader h2{ margin:0; font-size: 16px; font-weight: 980; }
    .pill{
      font-size: 12px;
      color: rgba(255,255,255,.85);
      border: 1px solid rgba(255,255,255,.16);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      white-space:nowrap;
    }

    .notice{
      margin-top: 10px;
      padding: 12px;
      border-radius: 16px;
      border: 1px dashed rgba(255,255,255,.18);
      background: rgba(0,0,0,.14);
      color: rgba(255,255,255,.72);
      font-size: 12.5px;
      line-height:1.5;
    }
    .notice b{ color: rgba(255,255,255,.92); }

    .tabs{
      display:flex; gap:8px; flex-wrap:wrap;
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      border-radius: 14px;
      padding: 8px;
    }
    .tabBtn{
      flex: 1 1 auto;
      min-width: 120px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.86);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 980;
      font-size: 12.5px;
      transition: .15s ease;
    }
    .tabBtn:hover{ border-color: rgba(41,243,209,.35); }
    .tabBtn.active{
      border-color: rgba(41,243,209,.55);
      box-shadow: 0 0 0 2px rgba(41,243,209,.12);
      background: rgba(41,243,209,.10);
      color: rgba(255,255,255,.95);
    }

    .panel{ display:none; margin-top: 10px; }
    .panel.active{ display:block; }

    /* List blocks */
    .list{
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      background: rgba(0,0,0,.16);
      overflow:hidden;
      margin-top: 10px;
    }
    .listHeader{
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .listHeader .title{
      display:flex; align-items:center; gap: 10px;
      font-size: 13.5px; color: rgba(255,255,255,.92);
      font-weight: 980;
    }
    .count{
      font-size: 12px;
      color: var(--muted2);
      border: 1px solid rgba(255,255,255,.14);
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      white-space:nowrap;
    }
    .items{ padding: 6px; }

    .item{
      display:grid;
      grid-template-columns: 18px 44px 1fr;
      gap: 10px;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.0);
      align-items:start;
    }
    .item:hover{
      border-color: rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .item input{ margin-top: 3px; }

    .thumb{
      width:44px; height:44px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      overflow:hidden;
      display:flex; align-items:center; justify-content:center;
      color: rgba(255,255,255,.45);
      font-size: 11px;
      font-weight: 980;
    }
    .thumb img{
      width:100%; height:100%;
      object-fit: cover;
      display:block;
    }
    .itemName{
      font-size: 13px;
      color: rgba(255,255,255,.94);
      display:flex;
      gap: 8px;
      align-items:center;
      flex-wrap:wrap;
      line-height:1.25;
      font-weight: 980;
    }
    .itemWhy{
      font-size: 12px;
      color: rgba(255,255,255,.62);
      margin-top: 3px;
      line-height:1.35;
    }

    .tag{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(41,243,209,.35);
      background: rgba(41,243,209,.09);
      color: rgba(255,255,255,.86);
      white-space:nowrap;
      font-weight: 980;
    }
    .tag.gray{
      border-color: rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.76);
    }
    .tag.premium{
      border-color: rgba(255,210,74,.45);
      background: rgba(255,210,74,.10);
      color: rgba(255,255,255,.90);
    }
    .tag.signature{
      border-color: rgba(41,243,209,.55);
      background: rgba(41,243,209,.14);
      color: rgba(255,255,255,.92);
    }

    /* Branch tabs (Add-ons paths) */
    .pathTabs, .subTabs{
      display:flex; gap:8px; flex-wrap:wrap;
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
      border-radius: 14px;
      padding: 8px;
    }
    .pathBtn, .subTabBtn{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.86);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 980;
      font-size: 12px;
    }
    .pathBtn.active, .subTabBtn.active{
      border-color: rgba(41,243,209,.55);
      background: rgba(41,243,209,.10);
      box-shadow: 0 0 0 2px rgba(41,243,209,.10);
    }
    .pathPanel, .subPanel{ display:none; margin-top: 10px; }
    .pathPanel.active, .subPanel.active{ display:block; }

    /* Show more button */
    .moreRow{
      padding: 10px 12px 12px;
      border-top: 1px solid rgba(255,255,255,.10);
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
    }
    .ghostBtn{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.9);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 980;
      font-size: 12px;
    }
    .ghostBtn:hover{ border-color: rgba(41,243,209,.35); }

    /* Builder nav */
    .navRow{
      display:flex;
      gap:10px;
      margin-top: 10px;
      flex-wrap:wrap;
    }
    .navRow .ghostBtn{ flex: 1 1 160px; }

    /* Error box */
    .err{
      margin-top: 10px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,120,120,.35);
      background: rgba(255,0,0,.06);
      color: rgba(255,255,255,.86);
      font-size: 12.5px;
      line-height:1.5;
      display:none;
    }
    .err code{ color: rgba(255,210,74,.9); }

    @media (max-width: 980px){
      .container{ flex-direction:column; }
      .left{ width:100%; flex: 1; }
      .right{ width:100%; }
    }
  </style>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>

  <div class="header">
    <div class="kicker"><span class="dot"></span> Fatirli • Smart Travel Kit Planner</div>
    <h1>Core first. Then “add-on & premium it up” with branching.</h1>
    <p class="sub">
      The point of this page is <b>selling the actual items</b>. So we show the <b>6 Core</b> immediately, then reveal more only when users want it.
    </p>
  </div>

  <div class="wrap">
    <div class="container">

      <!-- LEFT -->
      <div class="card left">
        <div class="sectionTitle">
          <h2>Your trip (fast)</h2>
          <div class="small">Target: 2–3 minutes</div>
        </div>

        <label>Primary country</label>
        <input id="country1" type="text" placeholder="e.g., Japan" />

        <label>Primary city (optional)</label>
        <input id="city1" type="text" placeholder="e.g., Kyoto" />

        <div class="row">
          <div>
            <label>Travel start date</label>
            <input id="startDate" type="date" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>Trip length</label>
            <select id="duration">
              <option value="weekend">Weekend (1–3 days)</option>
              <option value="week">About a week</option>
              <option value="twoWeeks">1–2 weeks</option>
              <option value="long">3+ weeks</option>
            </select>
          </div>
          <div>
            <label>Climate</label>
            <select id="climate">
              <option value="hotHumid">Hot & humid</option>
              <option value="hotDry">Hot & dry</option>
              <option value="coldDry">Cold & dry</option>
              <option value="coldWet">Cold & wet</option>
              <option value="mixed">Mixed / unsure</option>
            </select>
          </div>
        </div>

        <label>Trip style (pick what fits)</label>
        <div class="chips" id="tripStyleChips">
          <div class="chip on" data-value="city"><span class="miniDot"></span>City</div>
          <div class="chip" data-value="nature"><span class="miniDot"></span>Outdoors</div>
          <div class="chip" data-value="beach"><span class="miniDot"></span>Beach</div>
          <div class="chip" data-value="business"><span class="miniDot"></span>Business</div>
          <div class="chip" data-value="highActivity"><span class="miniDot"></span>High activity</div>
        </div>

        <!-- Collapsed by default but visible -->
        <details>
          <summary>
            <span>Optional modules</span>
            <span class="badgeHint"><span class="dot" style="width:7px;height:7px"></span>Personalize</span>
          </summary>
          <div class="detailsBody">
            <div class="checkrow">
              <input id="faithOn" type="checkbox" checked />
              <div>
                <b>Muslim travel module</b><br/>
                <span class="small">Unlocks Prayer + Hygiene/Wudu + Privacy/Modesty branches.</span>
              </div>
            </div>

            <div class="checkrow">
              <input id="kidsOn" type="checkbox" />
              <div>
                <b>Parent with kids</b><br/>
                <span class="small">Unlocks cleanup + privacy + convenience add-ons.</span>
              </div>
            </div>

            <div class="checkrow">
              <input id="makeupOn" type="checkbox" />
              <div>
                <b>Makeup / wipe-off</b><br/>
                <span class="small">Unlocks makeup wipes + quick skin reset items.</span>
              </div>
            </div>
          </div>
        </details>

        <button class="btn" id="buildBtn" type="button">Build my kit</button>
        <div class="small" style="margin-top:8px;">
          You’ll see <b>Core first</b> → then you can expand Add-ons & Premium.
        </div>
      </div>

      <!-- RIGHT -->
      <div class="card right" id="kitCard">
        <div class="kitHeader">
          <h2>Your kit</h2>
          <div class="pill" id="kitPill">Core ready • click “Build my kit”</div>
        </div>

        <div class="notice">
          <b>Reassurance:</b> You can’t “get this wrong”. Start with Core, then upgrade only if it fits you.
        </div>

        <div class="err" id="errBox"></div>

        <div class="tabs" role="tablist" aria-label="Kit Tabs">
          <button class="tabBtn active" data-tab="core" type="button">Core (6)</button>
          <button class="tabBtn" data-tab="addons" type="button">Add-ons</button>
          <button class="tabBtn" data-tab="premium" type="button">Premium</button>
        </div>

        <!-- IMPORTANT: Core has a STATIC fallback (so it never looks blank). JS will replace this. -->
        <div id="panel-core" class="panel active">
          <div class="list">
            <div class="listHeader">
              <div class="title">Core kit (6 essentials)</div>
              <div class="count">Always visible</div>
            </div>
            <div class="items">
              <div class="item">
                <input type="checkbox" checked disabled />
                <div class="thumb">IMG</div>
                <div>
                  <div class="itemName">Universal travel adapter (compact) <span class="tag gray">CORE</span></div>
                  <div class="itemWhy">Prevents the #1 avoidable fail: can’t charge anything.</div>
                </div>
              </div>

              <div class="item">
                <input type="checkbox" checked disabled />
                <div class="thumb">IMG</div>
                <div>
                  <div class="itemName">Portable power bank (travel size) <span class="tag gray">CORE</span></div>
                  <div class="itemWhy">Dead phone = no maps, no bookings, no transport.</div>
                </div>
              </div>

              <div class="item">
                <input type="checkbox" checked disabled />
                <div class="thumb">IMG</div>
                <div>
                  <div class="itemName">Expandable compressed wipes (coin wipes) <span class="tag gray">CORE</span> <span class="tag signature">Fatirli signature pick</span></div>
                  <div class="itemWhy">Tiny pack → full wipe with water. Toilets, flights, day trips.</div>
                </div>
              </div>

              <div class="item">
                <input type="checkbox" checked disabled />
                <div class="thumb">IMG</div>
                <div>
                  <div class="itemName">Disposable toothbrush + paste combo (single-use) <span class="tag gray">CORE</span> <span class="tag signature">Fatirli signature pick</span></div>
                  <div class="itemWhy">No sink? No problem. Zero mess, instant hygiene.</div>
                </div>
              </div>

              <div class="item">
                <input type="checkbox" checked disabled />
                <div class="thumb">IMG</div>
                <div>
                  <div class="itemName">Water-soluble soap sheets <span class="tag gray">CORE</span> <span class="tag signature">Fatirli signature pick</span></div>
                  <div class="itemWhy">Leak-proof + TSA-proof. Clean hands anywhere.</div>
                </div>
              </div>

              <div class="item">
                <input type="checkbox" checked disabled />
                <div class="thumb">IMG</div>
                <div>
                  <div class="itemName">Sunscreen stick (mess-free reapply) <span class="tag gray">CORE</span> <span class="tag signature">Fatirli signature pick</span></div>
                  <div class="itemWhy">People skip reapply because it’s annoying—stick fixes that.</div>
                </div>
              </div>
            </div>
          </div>

          <div class="navRow">
            <button class="ghostBtn" type="button" id="toAddonsFromCore">Add-on & premium it up →</button>
          </div>
        </div>

        <div id="panel-addons" class="panel">
          <div class="notice"><b>Tip:</b> This is where branching happens. Pick a path. You’ll see short lists first, with “Show more” if you want.</div>
        </div>

        <div id="panel-premium" class="panel">
          <div class="notice"><b>Premium:</b> optional upsells only (never required).</div>
        </div>
      </div>

    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const errBox = $("errBox");
  function showError(msg){
    errBox.style.display = "block";
    errBox.innerHTML = `<b>Kit rendering error:</b><br/><code>${msg}</code><br/><br/>
    If this appears after updating GitHub Pages, do a <b>hard refresh</b> (Ctrl+F5) or add <b>?v=2</b> to the URL.`;
  }

  function selectedTripStyles(){
    return new Set([...document.querySelectorAll("#tripStyleChips .chip.on")].map(x => x.dataset.value));
  }

  $("#tripStyleChips").addEventListener("click", (e)=>{
    const chip = e.target.closest(".chip");
    if(!chip) return;
    chip.classList.toggle("on");
    // do not force render unless already built
    if(window.__KIT_BUILT__) render();
  });

  function state(){
    return {
      tripStyle: selectedTripStyles(),
      climate: $("#climate").value,
      duration: $("#duration").value,
      faithOn: $("#faithOn").checked,
      kidsOn: $("#kidsOn").checked,
      makeupOn: $("#makeupOn").checked,
      country: $("#country1").value.trim(),
      city: $("#city1").value.trim()
    };
  }

  // Your finalized content (structured, branched, hideable)
  const ITEMS = [
    // ===== CORE (exactly 6; always shown) =====
    { id:"core_adapter", tier:"core", name:"Universal travel adapter (compact)", signature:false,
      why:"Prevents the #1 avoidable fail: can’t charge anything.", imgUrl:"", show:s=>true, defaultOn:true },

    { id:"core_powerbank", tier:"core", name:"Portable power bank (travel size)", signature:false,
      why:"Dead phone = no maps, no bookings, no transport.", imgUrl:"", show:s=>true, defaultOn:true },

    { id:"core_coinwipes", tier:"core", name:"Expandable compressed wipes (coin wipes)", signature:true,
      why:"Tiny pack → full wipe with water. Toilets, flights, day trips.", imgUrl:"", show:s=>true, defaultOn:true },

    { id:"core_disposablebrush", tier:"core", name:"Disposable toothbrush + paste combo (single-use)", signature:true,
      why:"No sink? No problem. Zero mess, instant hygiene.", imgUrl:"", show:s=>true, defaultOn:true },

    { id:"core_soapsheets", tier:"core", name:"Water-soluble soap sheets", signature:true,
      why:"Leak-proof + TSA-proof. Clean hands anywhere.", imgUrl:"", show:s=>true, defaultOn:true },

    { id:"core_sunstick", tier:"core", name:"Sunscreen stick (mess-free reapply)", signature:true,
      why:"People skip reapply because it’s annoying—stick fixes that.", imgUrl:"",
      show:s=> true, defaultOn:true },

    // ===== ADD-ONS (General) =====
    { id:"g_chewable", tier:"addon", path:"general", name:"Chewable toothpaste tablets", signature:true,
      why:"TSA-proof + no mess. A smarter backup than liquid paste.", imgUrl:"", show:s=>true, defaultOn:false },

    { id:"g_deowipes", tier:"addon", path:"general", name:"Single-use deodorant wipes (24h type)", signature:true,
      why:"Heat + long days + no shower = instant save.", imgUrl:"", show:s=>true, defaultOn:false },

    { id:"g_electrolytes", tier:"addon", path:"general", name:"Electrolyte sachets (hydration salts)", signature:true,
      why:"Stops heat/high-activity fatigue before it ruins the day.", imgUrl:"",
      show:s => s.tripStyle.has("highActivity") || s.tripStyle.has("nature") || String(s.climate).startsWith("hot"), defaultOn:false },

    { id:"g_fibre", tier:"addon", path:"general", name:"Fibre drink packets (travel bowel support)", signature:true,
      why:"Travel constipation is common—packets keep routine stable.", imgUrl:"",
      show:s => s.duration==="twoWeeks" || s.duration==="long", defaultOn:false },

    { id:"g_mist", tier:"addon", path:"general", name:"Hydration face mist (weather-dependent)", signature:false,
      why:"Dry cabins + AC hotels = tight skin. Mist is an easy reset.", imgUrl:"",
      show:s => s.climate==="coldDry" || s.climate==="hotDry" || s.duration!=="weekend", defaultOn:false },

    { id:"g_umbrella", tier:"addon", path:"general", name:"Mini foldable umbrella", signature:false,
      why:"Rain + harsh sun = low-effort regret prevention.", imgUrl:"",
      show:s => s.tripStyle.has("city") || s.climate==="coldWet" || String(s.climate).startsWith("hot"), defaultOn:false },

    { id:"g_poncho", tier:"addon", path:"general", name:"Lightweight foldable poncho", signature:false,
      why:"Rain hits fast—poncho prevents soaked clothes days.", imgUrl:"",
      show:s => s.climate==="coldWet" || s.tripStyle.has("nature"), defaultOn:false },

    { id:"g_powderwash", tier:"addon", path:"general", name:"Powder-activated face wash sachets", signature:true,
      why:"Proper cleansing without carrying liquid bottles.", imgUrl:"", show:s=>true, defaultOn:false },

    { id:"g_makeupwipes", tier:"addon", path:"general", name:"Makeup remover wipes (travel pack)", signature:false,
      why:"Exhausted? Wipes = you still remove makeup properly.", imgUrl:"",
      show:s => s.makeupOn, defaultOn:s=>!!s.makeupOn },

    // ===== ADD-ONS (Muslim travel) — 3 branches =====
    // Prayer
    { id:"m_prayermat", tier:"addon", path:"muslim", branch:"Prayer", name:"Packable prayer mat / tikar (thin)", signature:false,
      why:"Core prayer item that’s actually easy to carry.", imgUrl:"", show:s=>s.faithOn, defaultOn:true },

    { id:"m_qibla", tier:"addon", path:"muslim", branch:"Prayer", name:"Qibla card / compass", signature:true,
      why:"Fast direction check anywhere. Removes friction.", imgUrl:"", show:s=>s.faithOn, defaultOn:false },

    { id:"m_songkok", tier:"addon", path:"muslim", branch:"Prayer", name:"Foldable songkok (travel)", signature:true,
      why:"Optional prayer comfort without bulk.", imgUrl:"", show:s=>s.faithOn, defaultOn:false },

    { id:"m_telekung", tier:"addon", path:"muslim", branch:"Prayer", name:"Purse-size telekung travel set", signature:true,
      why:"Women’s prayer option that fits in a handbag.", imgUrl:"", show:s=>s.faithOn, defaultOn:false },

    // Hygiene & Wudu
    { id:"m_wudubottle", tier:"addon", path:"muslim", branch:"Hygiene/Wudu", name:"Wudu spray / travel wudu bottle", signature:false,
      why:"Makes wudu workable in awkward sinks & small toilets.", imgUrl:"", show:s=>s.faithOn, defaultOn:true },

    { id:"m_bidet", tier:"addon", path:"muslim", branch:"Hygiene/Wudu", name:"Portable bidet / rinse bottle (compact)", signature:true,
      why:"Cleaner routine; useful beyond faith too.", imgUrl:"", show:s=>s.faithOn, defaultOn:true },

    { id:"m_siwak", tier:"addon", path:"muslim", branch:"Hygiene/Wudu", name:"Pocket siwak (miswak)", signature:true,
      why:"Low-bulk refresh on the go.", imgUrl:"", show:s=>s.faithOn, defaultOn:false },

    { id:"m_soap_sheets_alt", tier:"addon", path:"muslim", branch:"Hygiene/Wudu", name:"Extra soap sheets (for toilets / wudu areas)", signature:false,
      why:"Public toilets vary—this keeps hygiene consistent.", imgUrl:"", show:s=>s.faithOn, defaultOn:false },

    // Privacy & Modesty (multi-use)
    { id:"m_privacytent", tier:"addon", path:"muslim", branch:"Privacy/Modesty", name:"Mini privacy tent (prayer / beach / kids / camping)", signature:true,
      why:"One item, multiple uses = high perceived value.", imgUrl:"",
      show:s => s.faithOn || s.kidsOn || s.tripStyle.has("beach") || s.tripStyle.has("nature"), defaultOn:false },

    { id:"m_miniprayertent", tier:"addon", path:"muslim", branch:"Privacy/Modesty", name:"Mini prayer tent (privacy upgrade)", signature:true,
      why:"Optional coverage in crowded areas—kept as upgrade.", imgUrl:"",
      show:s => s.faithOn, defaultOn:false },

    // ===== ADD-ONS (Parents) =====
    { id:"p_cleanup", tier:"addon", path:"parents", name:"Extra cleanup wipes (kids / spills)", signature:false,
      why:"Parents know: mess happens instantly. Prevents panic.", imgUrl:"",
      show:s => s.kidsOn, defaultOn:true },

    { id:"p_privacytent", tier:"addon", path:"parents", name:"Privacy tent (kid changing / beach / emergencies)", signature:true,
      why:"The ‘why didn’t I bring this?’ parent item.", imgUrl:"",
      show:s => s.kidsOn, defaultOn:false },

    // ===== PREMIUM =====
    { id:"pr_collagen", tier:"premium", name:"Hydration collagen face packets (tear + apply)", signature:true,
      why:"Plane/hotel quick skin reset. Premium feel, optional.", imgUrl:"",
      show:s => s.climate==="coldDry" || s.climate==="hotDry" || s.duration!=="weekend", defaultOn:false },

    { id:"pr_device", tier:"premium", name:"Travel-size skin booster device (portable beauty tool)", signature:false,
      why:"Premium tool for ‘device people’ only—kept optional.", imgUrl:"",
      show:s => s.duration==="long" || s.tripStyle.has("business"), defaultOn:false }
  ];

  const overrides = new Map(); // id -> bool
  const isOn = (it, st) => overrides.has(it.id) ? overrides.get(it.id) : (typeof it.defaultOn==="function" ? !!it.defaultOn(st) : !!it.defaultOn);

  function tagsFor(it){
    const tags = [];
    if(it.tier==="core") tags.push({cls:"tag gray", text:"CORE"});
    if(it.tier==="addon") tags.push({cls:"tag gray", text:"ADD-ON"});
    if(it.tier==="premium") tags.push({cls:"tag premium", text:"PREMIUM"});
    if(it.signature) tags.push({cls:"tag signature", text:"Fatirli signature pick"});
    return tags;
  }

  function itemRow(it, st){
    const row = document.createElement("div");
    row.className = "item";

    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.checked = isOn(it, st);
    cb.addEventListener("change", ()=> overrides.set(it.id, cb.checked));

    const thumb = document.createElement("div");
    thumb.className = "thumb";
    if(it.imgUrl){
      const img = document.createElement("img");
      img.alt = it.name;
      img.src = it.imgUrl;
      thumb.appendChild(img);
    } else {
      thumb.textContent = "IMG";
    }

    const main = document.createElement("div");
    const name = document.createElement("div");
    name.className = "itemName";
    name.textContent = it.name;

    tagsFor(it).forEach(t=>{
      const span = document.createElement("span");
      span.className = t.cls;
      span.textContent = t.text;
      name.appendChild(span);
    });

    const why = document.createElement("div");
    why.className = "itemWhy";
    why.textContent = it.why;

    main.appendChild(name);
    main.appendChild(why);

    row.appendChild(cb);
    row.appendChild(thumb);
    row.appendChild(main);
    return row;
  }

  function listBlock(title, rightText, rows, maxVisible=6){
    const box = document.createElement("div");
    box.className = "list";

    const head = document.createElement("div");
    head.className = "listHeader";
    head.innerHTML = `
      <div class="title">${title}</div>
      <div class="count">${rightText}</div>
    `;

    const body = document.createElement("div");
    body.className = "items";

    // Hide long lists by default (your main complaint)
    let expanded = false;

    function draw(){
      body.innerHTML = "";
      const shown = expanded ? rows : rows.slice(0, maxVisible);
      shown.forEach(r => body.appendChild(r));

      const needsMore = rows.length > maxVisible;
      const more = box.querySelector(".moreRow");
      if(more) more.remove();

      if(needsMore){
        const moreRow = document.createElement("div");
        moreRow.className = "moreRow";
        const left = document.createElement("div");
        left.className = "small";
        left.textContent = expanded ? "Showing all options." : `Showing top ${maxVisible}.`;
        const btn = document.createElement("button");
        btn.className = "ghostBtn";
        btn.type = "button";
        btn.textContent = expanded ? "Show less" : `Show more (${rows.length - maxVisible})`;
        btn.addEventListener("click", ()=>{ expanded = !expanded; draw(); });
        moreRow.appendChild(left);
        moreRow.appendChild(btn);
        box.appendChild(moreRow);
      }
    }

    box.appendChild(head);
    box.appendChild(body);
    draw();
    return box;
  }

  // Tabs
  function setTab(name){
    document.querySelectorAll(".tabBtn").forEach(b => b.classList.toggle("active", b.dataset.tab === name));
    document.querySelectorAll(".panel").forEach(p => p.classList.toggle("active", p.id === `panel-${name}`));
  }
  document.querySelectorAll(".tabBtn").forEach(btn => btn.addEventListener("click", ()=> setTab(btn.dataset.tab)));

  $("toAddonsFromCore").addEventListener("click", ()=>{
    setTab("addons");
    $("kitCard").scrollIntoView({behavior:"smooth", block:"start"});
  });

  function kitPillText(st){
    const parts = [];
    if(st.country) parts.push(st.country);
    if(st.city) parts.push(st.city);
    parts.push(st.faithOn ? "Muslim: ON" : "Muslim: OFF");
    parts.push(st.kidsOn ? "Kids: ON" : "Kids: OFF");
    return parts.join(" • ");
  }

  function render(){
    try{
      errBox.style.display = "none";

      const st = state();
      $("kitPill").textContent = window.__KIT_BUILT__ ? ("Kit built • " + kitPillText(st)) : ("Core ready • click “Build my kit”");

      const corePanel = $("panel-core");
      const addonsPanel = $("panel-addons");
      const premiumPanel = $("panel-premium");

      // Clear panels (JS replaces the fallback)
      corePanel.innerHTML = "";
      addonsPanel.innerHTML = "";
      premiumPanel.innerHTML = "";

      const visible = ITEMS.filter(it => it.show(st));

      // CORE — exactly 6
      const coreItems = visible.filter(it => it.tier==="core").slice(0,6);
      corePanel.appendChild(listBlock("Core kit (6 essentials)", "6 items", coreItems.map(it => itemRow(it, st)), 6));

      const coreNav = document.createElement("div");
      coreNav.className = "navRow";
      const goAdd = document.createElement("button");
      goAdd.className = "ghostBtn";
      goAdd.type = "button";
      goAdd.textContent = "Add-on & premium it up →";
      goAdd.addEventListener("click", ()=> setTab("addons"));
      coreNav.appendChild(goAdd);
      corePanel.appendChild(coreNav);

      // PREMIUM
      const prem = visible.filter(it => it.tier==="premium");
      premiumPanel.appendChild(listBlock("Premium (optional upsells)", `${prem.length} options`, prem.map(it => itemRow(it, st)), 6));
      const premNav = document.createElement("div");
      premNav.className = "navRow";
      const backCore1 = document.createElement("button");
      backCore1.className = "ghostBtn";
      backCore1.type = "button";
      backCore1.textContent = "← Back to Core";
      backCore1.addEventListener("click", ()=> setTab("core"));
      premNav.appendChild(backCore1);
      premiumPanel.appendChild(premNav);

      // ADD-ONS (branched)
      const pathWrap = document.createElement("div");

      const pathTabs = document.createElement("div");
      pathTabs.className = "pathTabs";
      pathTabs.innerHTML = `
        <button class="pathBtn active" data-path="general" type="button">General</button>
        <button class="pathBtn" data-path="muslim" type="button">Muslim travel</button>
        <button class="pathBtn" data-path="parents" type="button">Parents</button>
      `;
      pathWrap.appendChild(pathTabs);

      const panelGeneral = document.createElement("div");
      panelGeneral.className = "pathPanel active";
      panelGeneral.dataset.path = "general";

      const panelMuslim = document.createElement("div");
      panelMuslim.className = "pathPanel";
      panelMuslim.dataset.path = "muslim";

      const panelParents = document.createElement("div");
      panelParents.className = "pathPanel";
      panelParents.dataset.path = "parents";

      // General add-ons (hidden after 6)
      const gen = visible.filter(it => it.tier==="addon" && it.path==="general");
      panelGeneral.appendChild(listBlock("General add-ons (smart extras)", `${gen.length} options`, gen.map(it => itemRow(it, st)), 6));

      // Parents add-ons
      if(!st.kidsOn){
        const n = document.createElement("div");
        n.className = "notice";
        n.innerHTML = `<b>Parents module is OFF.</b> Turn on “Parent with kids” to unlock parent add-ons.`;
        panelParents.appendChild(n);
      } else {
        const parents = visible.filter(it => it.tier==="addon" && it.path==="parents");
        panelParents.appendChild(listBlock("Parents add-ons", `${parents.length} options`, parents.map(it => itemRow(it, st)), 6));
      }

      // Muslim add-ons (3 sub-branches)
      if(!st.faithOn){
        const n = document.createElement("div");
        n.className = "notice";
        n.innerHTML = `<b>Muslim travel module is OFF.</b> Turn it on to unlock Prayer + Hygiene/Wudu + Privacy/Modesty.`;
        panelMuslim.appendChild(n);
      } else {
        const muslimItems = visible.filter(it => it.tier==="addon" && it.path==="muslim");

        const subTabs = document.createElement("div");
        subTabs.className = "subTabs";
        subTabs.innerHTML = `
          <button class="subTabBtn active" data-branch="Prayer" type="button">Prayer</button>
          <button class="subTabBtn" data-branch="Hygiene/Wudu" type="button">Hygiene & Wudu</button>
          <button class="subTabBtn" data-branch="Privacy/Modesty" type="button">Privacy & Modesty</button>
        `;
        panelMuslim.appendChild(subTabs);

        const subPrayer = document.createElement("div");
        subPrayer.className = "subPanel active";
        const subWudu = document.createElement("div");
        subWudu.className = "subPanel";
        const subPrivacy = document.createElement("div");
        subPrivacy.className = "subPanel";

        const prayer = muslimItems.filter(x => x.branch==="Prayer");
        const wudu = muslimItems.filter(x => x.branch==="Hygiene/Wudu");
        const privacy = muslimItems.filter(x => x.branch==="Privacy/Modesty");

        subPrayer.appendChild(listBlock("Prayer branch", `${prayer.length} options`, prayer.map(it => itemRow(it, st)), 6));
        subWudu.appendChild(listBlock("Hygiene & Wudu branch", `${wudu.length} options`, wudu.map(it => itemRow(it, st)), 6));
        subPrivacy.appendChild(listBlock("Privacy & Modesty branch", `${privacy.length} options`, privacy.map(it => itemRow(it, st)), 6));

        panelMuslim.appendChild(subPrayer);
        panelMuslim.appendChild(subWudu);
        panelMuslim.appendChild(subPrivacy);

        // subtab click
        subTabs.querySelectorAll(".subTabBtn").forEach(btn=>{
          btn.addEventListener("click", ()=>{
            subTabs.querySelectorAll(".subTabBtn").forEach(b=>b.classList.toggle("active", b===btn));
            const br = btn.dataset.branch;
            subPrayer.classList.toggle("active", br==="Prayer");
            subWudu.classList.toggle("active", br==="Hygiene/Wudu");
            subPrivacy.classList.toggle("active", br==="Privacy/Modesty");
          });
        });
      }

      pathWrap.appendChild(panelGeneral);
      pathWrap.appendChild(panelMuslim);
      pathWrap.appendChild(panelParents);

      // path clicks
      pathTabs.querySelectorAll(".pathBtn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const target = btn.dataset.path;
          pathWrap.querySelectorAll(".pathBtn").forEach(b=>b.classList.toggle("active", b===btn));
          pathWrap.querySelectorAll(".pathPanel").forEach(p=>p.classList.toggle("active", p.dataset.path===target));
        });
      });

      // Add-ons nav
      const addonsNav = document.createElement("div");
      addonsNav.className = "navRow";
      const backCore = document.createElement("button");
      backCore.className = "ghostBtn";
      backCore.type = "button";
      backCore.textContent = "← Back to Core";
      backCore.addEventListener("click", ()=> setTab("core"));
      const goPrem = document.createElement("button");
      goPrem.className = "ghostBtn";
      goPrem.type = "button";
      goPrem.textContent = "Go Premium →";
      goPrem.addEventListener("click", ()=> setTab("premium"));
      addonsNav.appendChild(backCore);
      addonsNav.appendChild(goPrem);

      addonsPanel.appendChild(pathWrap);
      addonsPanel.appendChild(addonsNav);

    } catch(e){
      showError(e && e.message ? e.message : String(e));
      console.error(e);
    }
  }

  // Build button = turn on builder mode + render + jump to kit
  $("buildBtn").addEventListener("click", ()=>{
    window.__KIT_BUILT__ = true;
    render();
    $("kitCard").scrollIntoView({behavior:"smooth", block:"start"});
    setTab("core");
  });

  // If user changes fields after building, live update
  ["climate","duration","faithOn","kidsOn","makeupOn","country1","city1"].forEach(id=>{
    $(id).addEventListener("change", ()=> { if(window.__KIT_BUILT__) render(); });
    $(id).addEventListener("input", ()=> { if(window.__KIT_BUILT__) render(); });
  });

  // On load: ensure something renders (core fallback exists anyway)
  window.__KIT_BUILT__ = false;
})();
</script>
</body>
</html>
