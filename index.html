<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Fatirli Smart Travel Kit Planner</title>
  <style>
    :root{
      --bg:#071018;
      --card: rgba(10, 20, 30, .72);
      --card2: rgba(10, 20, 30, .60);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(0,255,220,.25);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --muted2: rgba(255,255,255,.45);
      --accent: #22ffd7;
      --accent2:#0bb7a8;
      --danger:#ff5a7a;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: var(--bg);
      min-height:100vh;
      overflow-x:hidden;
    }

    /* Animated background layer that NEVER blocks clicks */
    .bg{
      position:fixed;
      inset:0;
      z-index:-2;
      background-image: url("travel-bg.webp");
      background-size: cover;
      background-position: center;
      filter: saturate(1.1) contrast(1.05);
      transform: translateZ(0);
    }
    .bg::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(1200px 900px at 20% 15%, rgba(34,255,215,.18), transparent 55%),
        radial-gradient(900px 700px at 85% 55%, rgba(34,255,215,.10), transparent 60%),
        linear-gradient(to bottom, rgba(0,0,0,.30), rgba(0,0,0,.55));
      pointer-events:none;
    }
    .bg.moving{
      animation: bgPan 22s ease-in-out infinite alternate;
    }
    @keyframes bgPan{
      from { transform: scale(1.08) translate(-1.2%, -0.8%); }
      to   { transform: scale(1.08) translate( 1.2%,  0.9%); }
    }
    @media (prefers-reduced-motion: reduce){
      .bg.moving{ animation:none; }
    }

    .wrap{
      width:min(1180px, calc(100% - 28px));
      margin: 28px auto 36px;
      display:grid;
      grid-template-columns: 420px 1fr;
      gap: 18px;
      align-items:start;
    }

    .topbar{
      width:min(1180px, calc(100% - 28px));
      margin: 22px auto 0;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .brand{
      display:flex; flex-direction:column; gap:4px;
    }
    .brand .kicker{
      letter-spacing:.16em;
      text-transform:uppercase;
      font-size:12px;
      color: rgba(34,255,215,.85);
      display:flex;
      align-items:center;
      gap:10px;
    }
    .dot{
      width:9px;height:9px;border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 18px rgba(34,255,215,.55);
      flex:0 0 auto;
    }
    .brand h1{
      margin:0;
      font-size: 22px;
      line-height:1.15;
      letter-spacing:.2px;
    }
    .brand p{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      max-width: 64ch;
    }

    .pillNote{
      font-size: 12px;
      color: var(--muted);
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.22);
      padding: 10px 12px;
      border-radius: 999px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      white-space:nowrap;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .card .head{
      padding: 16px 16px 10px;
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:10px;
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .card .head h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.06em;
      text-transform:uppercase;
      color: rgba(255,255,255,.78);
    }
    .small{
      font-size: 12px;
      color: var(--muted2);
    }

    .body{
      padding: 14px 16px 16px;
    }

    label{
      display:block;
      font-size: 12px;
      color: rgba(255,255,255,.78);
      margin: 10px 0 6px;
    }

    input[type="text"], input[type="date"], select{
      width:100%;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      color: var(--text);
      padding: 12px 12px;
      outline:none;
      font-size: 16px; /* IMPORTANT: stops iOS auto-zoom + improves tap typing */
    }
    input::placeholder{ color: rgba(255,255,255,.35); }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-items:end;
    }

    /* Clickable pill controls (fixes "only circle clickable") */
    .pillRow{
      display:flex; flex-wrap:wrap; gap:10px;
      margin-top: 8px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.20);
      padding: 10px 12px;
      cursor:pointer;
      user-select:none;
      transition: .15s ease;
      min-height: 44px; /* tap target */
    }
    .pill:hover{ border-color: rgba(34,255,215,.35); }
    .pill input{
      appearance:none;
      width: 14px; height: 14px;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,.35);
      display:inline-block;
      position: relative;
      margin:0;
      flex:0 0 auto;
      background: transparent;
    }
    .pill input:checked{
      border-color: rgba(34,255,215,.95);
      box-shadow: 0 0 0 4px rgba(34,255,215,.18);
    }
    .pill input:checked::after{
      content:"";
      position:absolute;
      inset:3px;
      border-radius:999px;
      background: var(--accent);
    }
    .pill .txt{
      font-size: 13px;
      color: rgba(255,255,255,.88);
      letter-spacing:.2px;
    }

    /* Optional modules checkboxes (whole row clickable) */
    .modules{
      margin-top: 12px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.16);
      border-radius: 14px;
      padding: 10px;
    }
    .modRow{
      display:flex;
      align-items:flex-start;
      gap:10px;
      padding: 10px;
      border-radius: 12px;
      cursor:pointer;
      min-height: 48px;
      user-select:none;
    }
    .modRow:hover{ background: rgba(255,255,255,.04); }
    .modRow input{
      width: 18px; height: 18px;
      margin-top: 2px;
      accent-color: var(--accent);
      flex:0 0 auto;
    }
    .modText{ display:flex; flex-direction:column; gap:2px; }
    .modTitle{ font-size: 13px; color: rgba(255,255,255,.92); }
    .modDesc{ font-size: 12px; color: var(--muted2); }

    .ctaRow{
      margin-top: 14px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .btn{
      width:100%;
      border:0;
      border-radius: 14px;
      background: linear-gradient(90deg, rgba(34,255,215,.95), rgba(11,183,168,.95));
      color: #062018;
      font-weight: 800;
      letter-spacing:.3px;
      padding: 14px 14px;
      cursor:pointer;
      min-height: 48px;
    }
    .btn:active{ transform: translateY(1px); }
    .hint{
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted2);
    }

    /* Right side tabs + output */
    .tabs{
      display:flex;
      gap:10px;
      padding: 12px 12px 0;
    }
    .tabBtn{
      flex:1;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.86);
      padding: 10px 12px;
      cursor:pointer;
      font-weight: 700;
      min-height: 44px;
    }
    .tabBtn.active{
      border-color: rgba(34,255,215,.50);
      box-shadow: 0 0 0 4px rgba(34,255,215,.10);
      color: #dffef8;
    }
    .reassure{
      margin: 12px 16px 0;
      border: 1px dashed rgba(255,255,255,.14);
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 12px;
      color: rgba(255,255,255,.72);
      background: rgba(0,0,0,.16);
    }

    .panel{
      padding: 12px 16px 16px;
    }

    details.branch{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      border-radius: 14px;
      padding: 10px 12px;
      margin: 10px 0;
    }
    details.branch > summary{
      cursor:pointer;
      list-style:none;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-weight: 800;
      color: rgba(255,255,255,.92);
      min-height: 44px;
    }
    details.branch > summary::-webkit-details-marker{ display:none; }
    .sumHint{
      font-size: 12px;
      color: var(--muted2);
      font-weight: 600;
    }

    .kitList{
      margin-top: 10px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .item{
      display:grid;
      grid-template-columns: 44px 1fr;
      gap: 12px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      align-items:start;
    }
    .thumb{
      width:44px;height:44px;border-radius: 12px;
      border: 1px solid rgba(34,255,215,.22);
      background: rgba(34,255,215,.07);
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
    }
    .itemTop{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
    }
    .name{
      font-weight: 900;
      letter-spacing:.1px;
      font-size: 13px;
      color: rgba(255,255,255,.95);
    }
    .why{
      margin-top: 3px;
      font-size: 12px;
      color: rgba(255,255,255,.65);
      line-height: 1.25;
    }
    .badges{
      display:flex;
      flex-wrap:wrap;
      justify-content:flex-end;
      gap:6px;
    }
    .badge{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.75);
      white-space:nowrap;
    }
    .badge.core{ border-color: rgba(34,255,215,.35); color: rgba(34,255,215,.92); }
    .badge.addon{ border-color: rgba(255,255,255,.16); color: rgba(255,255,255,.78); }
    .badge.premium{ border-color: rgba(255,200,90,.35); color: rgba(255,200,90,.92); }
    .badge.sig{ border-color: rgba(34,255,215,.35); color: rgba(255,255,255,.88); background: rgba(34,255,215,.10); }

    .softEnd{
      margin-top: 12px;
      padding: 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.16);
      border: 1px solid rgba(255,255,255,.10);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .softEnd .txt{
      font-size: 12px;
      color: rgba(255,255,255,.74);
      line-height:1.25;
    }
    .miniBtn{
      border-radius: 12px;
      border: 1px solid rgba(34,255,215,.35);
      background: rgba(34,255,215,.12);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      cursor:pointer;
      font-weight: 800;
      min-height: 42px;
      white-space:nowrap;
    }

    /* Responsive */
    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; }
      .pillNote{ display:none; }
    }
  </style>
</head>

<body>
  <div class="bg moving" aria-hidden="true"></div>

  <div class="topbar">
    <div class="brand">
      <div class="kicker"><span class="dot"></span> Fatirli’s Travel Essentials Planner · Smart kit builder</div>
      <h1>Build your travel essentials kit — start with Core, then upgrade only if it fits you.</h1>
      <p>First run should feel fast (2–3 minutes). You’ll see the Core kit first, then Add-ons & Premium unlock as optional branches.</p>
    </div>
    <div class="pillNote">Tip: after updating GitHub Pages, refresh with <b>?v=3</b></div>
  </div>

  <div class="wrap">

    <!-- LEFT: Form -->
    <section class="card">
      <div class="head">
        <div>
          <h2>Your trip (fast)</h2>
          <div class="small">Target: 2–3 minutes</div>
        </div>
        <div class="small">Core first · then “premium it up”</div>
      </div>

      <div class="body">
        <label>Primary country</label>
        <input id="country" type="text" placeholder="e.g., Japan" autocomplete="country-name" />

        <label>Primary city (optional)</label>
        <input id="city" type="text" placeholder="e.g., Kyoto" autocomplete="address-level2" />

        <label>Travel start date</label>
        <input id="startDate" type="date" />

        <div class="grid2">
          <div>
            <label>Trip length</label>
            <select id="tripLength">
              <option value="weekend">Weekend (1–3 days)</option>
              <option value="short">Short (4–7 days)</option>
              <option value="twoWeeks">1–2 weeks</option>
              <option value="long">3+ weeks</option>
            </select>
          </div>
          <div>
            <label>Climate</label>
            <select id="climate">
              <option value="hotHumid">Hot & humid</option>
              <option value="hotDry">Hot & dry</option>
              <option value="coldDry">Cold & dry</option>
              <option value="coldWet">Cold & wet</option>
              <option value="mixed">Mixed / unsure</option>
            </select>
          </div>
        </div>

        <label>Trip style (pick what fits)</label>
        <div class="pillRow" id="tripStyle">
          <!-- Entire pill clickable -->
          <label class="pill"><input type="radio" name="style" value="city" checked><span class="txt">City</span></label>
          <label class="pill"><input type="radio" name="style" value="outdoors"><span class="txt">Outdoors</span></label>
          <label class="pill"><input type="radio" name="style" value="beach"><span class="txt">Beach</span></label>
          <label class="pill"><input type="radio" name="style" value="business"><span class="txt">Business</span></label>
        </div>

        <label>Optional modules</label>
        <div class="modules">
          <label class="modRow">
            <input id="modMuslim" type="checkbox" checked />
            <span class="modText">
              <span class="modTitle">Muslim travel module</span>
              <span class="modDesc">Unlocks Prayer + Hygiene/Wudu + Privacy/Modesty branches.</span>
            </span>
          </label>

          <label class="modRow">
            <input id="modKids" type="checkbox" />
            <span class="modText">
              <span class="modTitle">Parent with kids</span>
              <span class="modDesc">Unlocks cleanup + changing privacy + convenience add-ons.</span>
            </span>
          </label>

          <label class="modRow">
            <input id="modMakeup" type="checkbox" />
            <span class="modText">
              <span class="modTitle">Makeup / wipe-off</span>
              <span class="modDesc">Unlocks makeup wipes + quick “skin reset” items.</span>
            </span>
          </label>
        </div>

        <div class="ctaRow">
          <button class="btn" id="buildBtn">Build my kit</button>
        </div>
        <div class="hint">You’ll see <b>Core (6)</b> first — then you can expand Add-ons & Premium only if you want.</div>
      </div>
    </section>

    <!-- RIGHT: Output -->
    <section class="card">
      <div class="head">
        <div>
          <h2>Your kit</h2>
          <div class="small">Core appears first · Add-ons & Premium are optional branches</div>
        </div>
        <div class="small" id="statusPill">Waiting for inputs…</div>
      </div>

      <div class="reassure" id="reassure">
        Reassurance: You can’t “get this wrong”. Start with Core, then upgrade only if it fits you.
      </div>

      <div class="tabs">
        <button class="tabBtn active" data-tab="core">Core (6)</button>
        <button class="tabBtn" data-tab="addons">Add-ons</button>
        <button class="tabBtn" data-tab="premium">Premium</button>
      </div>

      <div class="panel">
        <div id="tab-core" class="tabPane"></div>
        <div id="tab-addons" class="tabPane" style="display:none;"></div>
        <div id="tab-premium" class="tabPane" style="display:none;"></div>

        <div class="softEnd">
          <div class="txt"><b>Soft end:</b> Want to refine this? Add modules, switch trip style, then rebuild.</div>
          <button class="miniBtn" id="refineBtn">Refine</button>
        </div>
      </div>
    </section>

  </div>

<script>
/* ---------- tiny SVG “sample photos” (placeholders) ---------- */
function iconSVG(letter){
  return `
  <svg width="44" height="44" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <defs>
      <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0" stop-color="rgba(34,255,215,.35)"/>
        <stop offset="1" stop-color="rgba(34,255,215,.05)"/>
      </linearGradient>
    </defs>
    <rect x="1" y="1" width="42" height="42" rx="12" fill="url(#g)" stroke="rgba(34,255,215,.35)"/>
    <text x="22" y="26" text-anchor="middle" font-size="15" font-weight="900"
      fill="rgba(255,255,255,.92)" font-family="system-ui, -apple-system, Segoe UI, Roboto">${letter}</text>
  </svg>`;
}

/* ---------- Item catalog (your selling points live here) ---------- */
const CATALOG = {
  core: [
    {id:"adapter", letter:"A", name:"Universal travel adapter (compact)", tier:"CORE", signature:false,
      why:"Prevents the #1 avoidable fail: dead phone + no charging."},
    {id:"powerbank", letter:"P", name:"Portable power bank (travel size)", tier:"CORE", signature:false,
      why:"Keeps maps, bookings, camera, and translations alive."},
    {id:"coinwipes", letter:"W", name:"Expandable compressed wipes (coin wipes)", tier:"CORE", signature:true,
      why:"Tiny pack → full wipe with water. Toilets, flights, day trips."},
    {id:"brushpaste", letter:"T", name:"Disposable toothbrush + paste combo (single-use)", tier:"CORE", signature:true,
      why:"No sink? No problem. Zero mess, instant hygiene."},
    {id:"soapsheets", letter:"S", name:"Water-soluble soap sheets", tier:"CORE", signature:true,
      why:"Leak-proof + TSA-proof. Clean hands anywhere."},
    {id:"sunstick", letter:"UV", name:"Sunscreen stick (mess-free reapply)", tier:"CORE", signature:true,
      why:"People skip reapply because it’s annoying — stick fixes that."},
  ],

  addons: {
    "Hydration & gut (smart comfort)": [
      {id:"hydrationsalts", letter:"H", name:"Hydration salts sachets (AM boost)", tier:"ADD-ON", signature:true,
        why:"Hot weather + high activity → dehydration sneaks up fast."},
      {id:"fibre", letter:"F", name:"Fibre / bowel-movement packets (travel routine)", tier:"ADD-ON", signature:false,
        why:"Travel constipation is common — packets keep routine consistent."},
      {id:"mist", letter:"M", name:"Hydration face mist (climate + flight)", tier:"ADD-ON", signature:false,
        why:"Cabin air + dry climates can trigger tight, dull skin."},
      {id:"collagen", letter:"C", name:"Hydration collagen tear-packets (on-plane reset)", tier:"ADD-ON", signature:true,
        why:"Fast skin comfort when you can’t do full skincare."}
    ],

    "Weather & rain-ready": [
      {id:"poncho", letter:"R", name:"Lightweight foldable poncho", tier:"ADD-ON", signature:false,
        why:"Rain surprise + hands full = poncho beats umbrella."},
      {id:"umbrella", letter:"U", name:"Mini foldable umbrella", tier:"ADD-ON", signature:false,
        why:"Best for city travel + unpredictable showers."}
    ],

    "Beauty reset (wipe-off)": [
      {id:"makeupwipes", letter:"MW", name:"Makeup wipes (quick wipe-off)", tier:"ADD-ON", signature:true,
        why:"Fast ‘reset’ when you’re too tired for a full routine."},
      {id:"powderwash", letter:"PW", name:"Powder-activated face wash (no leaks)", tier:"ADD-ON", signature:true,
        why:"No liquid leaks. Works even in tiny hotel sinks."}
    ],

    "Privacy & changing (multi-purpose)": [
      {id:"privacytent", letter:"PT", name:"Mini privacy tent (change / pray / beach / kids)", tier:"ADD-ON", signature:true,
        why:"Muslim prayer privacy + beach changing + kids changing = 1 item, many jobs."}
    ],

    "Hygiene upgrades": [
      {id:"deowipes", letter:"D", name:"One-time deodorant wipes (24h feel)", tier:"ADD-ON", signature:true,
        why:"Perfect for long travel days when showers aren’t realistic."},
      {id:"portablebidet", letter:"B", name:"Portable bidet (travel wash)", tier:"ADD-ON", signature:true,
        why:"Hygiene comfort when bathrooms are not ideal."},
      {id:"siwak", letter:"SW", name:"Siwak / miswak stick", tier:"ADD-ON", signature:true,
        why:"Quick mouth refresh, especially between prayers or long flights."},
      {id:"qibla", letter:"Q", name:"Qibla compass / card", tier:"ADD-ON", signature:true,
        why:"Removes the ‘where is Qibla?’ stress when travelling."},
      {id:"wudu", letter:"WU", name:"Wudu spray / bottle (easy wash)", tier:"ADD-ON", signature:true,
        why:"Airport / public toilets → cleaner, simpler wudu."}
    ]
  },

  premium: {
    "Premium skin & convenience": [
      {id:"skinbooster", letter:"SB", name:"Travel-size skin booster device (premium)", tier:"PREMIUM", signature:true,
        why:"For people who care about glow + hydration while travelling."}
    ],
    "Faith & modesty premium": [
      {id:"telkung", letter:"TK", name:"Purse travel telekung set (compact)", tier:"PREMIUM", signature:true,
        why:"Full coverage + compact packing."},
      {id:"songkok", letter:"SK", name:"Foldable songkok (compact)", tier:"PREMIUM", signature:true,
        why:"Easy for mosque visits without bulky caps."},
      {id:"minitikar", letter:"PM", name:"Prayer mat / tikar (compact fold)", tier:"PREMIUM", signature:false,
        why:"More comfort + cleaner prayer anywhere."}
    ]
  }
};

/* ---------- Branching rules (light, practical) ---------- */
function getProfile(){
  const country = document.getElementById("country").value.trim();
  const city = document.getElementById("city").value.trim();
  const startDate = document.getElementById("startDate").value;
  const tripLength = document.getElementById("tripLength").value;
  const climate = document.getElementById("climate").value;
  const style = document.querySelector('#tripStyle input[name="style"]:checked')?.value || "city";

  const muslim = document.getElementById("modMuslim").checked;
  const kids = document.getElementById("modKids").checked;
  const makeup = document.getElementById("modMakeup").checked;

  return { country, city, startDate, tripLength, climate, style, muslim, kids, makeup };
}

function shouldInclude(itemId, profile){
  // Keep logic simple & user-friendly: only add “extras” when signals exist.
  const hot = profile.climate === "hotHumid" || profile.climate === "hotDry";
  const cold = profile.climate === "coldDry" || profile.climate === "coldWet";
  const wet = profile.climate === "coldWet";
  const outdoorsy = profile.style === "outdoors" || profile.style === "beach";
  const longer = profile.tripLength === "twoWeeks" || profile.tripLength === "long";

  switch(itemId){
    case "hydrationsalts": return hot || outdoorsy;
    case "fibre": return longer;
    case "mist": return cold || profile.climate === "hotDry";
    case "collagen": return profile.makeup || longer;
    case "poncho": return wet || outdoorsy;
    case "umbrella": return profile.style === "city";
    case "makeupwipes": return profile.makeup;
    case "powderwash": return profile.makeup || longer;
    case "privacytent": return profile.muslim || profile.kids || outdoorsy;
    case "portablebidet": return profile.muslim || longer;
    case "siwak": return profile.muslim;
    case "qibla": return profile.muslim;
    case "wudu": return profile.muslim;
    case "telkung": return profile.muslim;
    case "songkok": return profile.muslim;
    case "minitikar": return profile.muslim;
    default: return true;
  }
}

function renderItem(it){
  const tierClass = it.tier === "CORE" ? "core" : (it.tier === "PREMIUM" ? "premium" : "addon");
  return `
    <div class="item">
      <div class="thumb">${iconSVG(it.letter || "I")}</div>
      <div>
        <div class="itemTop">
          <div>
            <div class="name">${it.name}</div>
            <div class="why">${it.why || ""}</div>
          </div>
          <div class="badges">
            <span class="badge ${tierClass}">${it.tier}</span>
            ${it.signature ? `<span class="badge sig">Fatirli signature pick</span>` : ``}
          </div>
        </div>
      </div>
    </div>
  `;
}

function buildCore(){
  const coreWrap = document.getElementById("tab-core");
  coreWrap.innerHTML = `
    <div class="small" style="margin-bottom:10px;">Core kit (6 essentials) — always short on purpose.</div>
    <div class="kitList">${CATALOG.core.map(renderItem).join("")}</div>
  `;
}

function buildAddons(profile){
  const addonsWrap = document.getElementById("tab-addons");

  // Branching UI: collapsed sections.
  let html = `<div class="small" style="margin-bottom:8px;">Add-ons are optional — open only what applies.</div>`;

  Object.entries(CATALOG.addons).forEach(([branchName, items]) => {
    const filtered = items.filter(x => shouldInclude(x.id, profile));
    if(!filtered.length) return;

    html += `
      <details class="branch">
        <summary>
          <span>${branchName}</span>
          <span class="sumHint">${filtered.length} suggestions</span>
        </summary>
        <div class="kitList">${filtered.map(renderItem).join("")}</div>
      </details>
    `;
  });

  // If muslim module not selected, hide faith-heavy hints by not showing some branches (we already filtered).
  addonsWrap.innerHTML = html;
}

function buildPremium(profile){
  const premWrap = document.getElementById("tab-premium");
  let html = `<div class="small" style="margin-bottom:8px;">Premium = “nice to have” upgrades, not mandatory.</div>`;

  Object.entries(CATALOG.premium).forEach(([branchName, items]) => {
    const filtered = items.filter(x => shouldInclude(x.id, profile));
    if(!filtered.length) return;

    html += `
      <details class="branch">
        <summary>
          <span>${branchName}</span>
          <span class="sumHint">${filtered.length} upgrades</span>
        </summary>
        <div class="kitList">${filtered.map(renderItem).join("")}</div>
      </details>
    `;
  });

  premWrap.innerHTML = html;
}

/* ---------- Tabs ---------- */
document.querySelectorAll(".tabBtn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".tabBtn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    const tab = btn.dataset.tab;
    document.getElementById("tab-core").style.display = tab === "core" ? "" : "none";
    document.getElementById("tab-addons").style.display = tab === "addons" ? "" : "none";
    document.getElementById("tab-premium").style.display = tab === "premium" ? "" : "none";
  });
});

/* ---------- Build button ---------- */
document.getElementById("buildBtn").addEventListener("click", () => {
  const profile = getProfile();

  // Status
  const where = [profile.city, profile.country].filter(Boolean).join(", ");
  document.getElementById("statusPill").textContent =
    where ? `Kit built for: ${where}` : "Kit built (add destination anytime)";

  // Always show core first (your requirement)
  buildCore();
  buildAddons(profile);
  buildPremium(profile);

  // Force Core tab
  document.querySelector('.tabBtn[data-tab="core"]').click();

  // Gentle hint (soft end)
  document.getElementById("reassure").innerHTML =
    `Reassurance: You can’t “get this wrong”. Start with <b>Core</b>, then open <b>Add-ons</b> only if it applies to you.`;

  // Scroll output into view on smaller screens
  if (window.innerWidth < 980) {
    document.querySelectorAll(".card")[1].scrollIntoView({behavior:"smooth", block:"start"});
  }
});

/* Soft-end refine */
document.getElementById("refineBtn").addEventListener("click", () => {
  if (window.innerWidth < 980) {
    document.querySelectorAll(".card")[0].scrollIntoView({behavior:"smooth", block:"start"});
  } else {
    document.getElementById("country").focus();
  }
});

/* Initial render so it doesn't look empty */
buildCore();
buildAddons(getProfile());
buildPremium(getProfile());

</script>
</body>
</html>
